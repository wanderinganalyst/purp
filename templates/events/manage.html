{% extends 'base.html' %}

{% block title %}Manage Events - BecauseImStuck{% endblock %}

{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h2 mb-1" style="color: var(--royal-purple);">
        <i class="bi bi-calendar-event-fill"></i> {% if user and user.role == 'admin' %}All Events{% else %}My Events{% endif %}
      </h1>
      {% if rep %}
        <p class="text-muted mb-0">Manage events for {{ rep.name }} - District {{ rep.district }}</p>
      {% elif user and user.role == 'admin' %}
        <p class="text-muted mb-0">Manage all events across all representatives</p>
      {% endif %}
    </div>
    <a href="{{ url_for('events.create_event') }}" class="btn" style="background: var(--royal-purple); color: white;">
      <i class="bi bi-plus-circle"></i> Create Event
    </a>
  </div>

  {% if events %}
    <div class="list-group shadow">
      {% for event in events %}
        <div class="list-group-item" style="border-left: 4px solid var(--light-purple);">
          <div class="d-flex justify-content-between align-items-start">
            <div class="flex-grow-1">
              <h5 style="color: var(--deep-purple);">{{ event.title }}</h5>
              {% if event.description %}
                <p class="mb-2">{{ event.description[:150] }}{% if event.description|length > 150 %}...{% endif %}</p>
              {% endif %}
              <div class="small text-muted mb-2">
                {% if user and user.role == 'admin' %}
                  <div><i class="bi bi-person-badge"></i> <strong>{{ event.representative.name }}</strong> - {{ event.representative.position }} (District {{ event.representative.district }})</div>
                {% endif %}
                <div><i class="bi bi-calendar3"></i> {{ event.event_date.strftime('%B %d, %Y at %I:%M %p') }}</div>
                {% if event.location %}
                  <div><i class="bi bi-geo-alt-fill"></i> {{ event.location }}</div>
                {% endif %}
                {% if event.event_type %}
                  <span class="badge mt-1" style="background: var(--royal-purple);">
                    {{ event.event_type.replace('_', ' ').title() }}
                  </span>
                {% endif %}
                {% if event.template %}
                  <span class="badge bg-success mt-1">
                    <i class="bi bi-cart"></i> {{ event.template.name }}
                  </span>
                {% endif %}
              </div>
            </div>
            <div class="ms-3">
              <div class="btn-group-vertical" role="group">
                <div class="btn-group" role="group">
                  <a href="{{ url_for('events.manage_invitations', event_id=event.id) }}" 
                     class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-envelope"></i> Invitations
                  </a>
                  <a href="{{ url_for('events.edit_event', event_id=event.id) }}" 
                     class="btn btn-sm btn-outline-secondary">
                    <i class="bi bi-pencil"></i> Edit
                  </a>
                  <form method="post" action="{{ url_for('events.delete_event', event_id=event.id) }}" 
                        style="display: inline;"
                        onsubmit="return confirm('Are you sure you want to delete this event?');">
                    <button type="submit" class="btn btn-sm btn-outline-danger">
                      <i class="bi bi-trash"></i> Delete
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert" style="background: var(--pale-purple); border-left: 4px solid var(--royal-purple);">
      <i class="bi bi-info-circle-fill"></i> You haven't created any events yet.
      <a href="{{ url_for('events.create_event') }}" class="alert-link">Create your first event</a> to engage with constituents.
    </div>
  {% endif %}
{% endblock %}
