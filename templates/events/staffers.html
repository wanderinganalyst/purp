{% extends 'base.html' %}

{% block title %}Manage Staffers - Purp{% endblock %}

{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h2 mb-1" style="color: var(--royal-purple);">
        <i class="bi bi-people-fill"></i> Manage Rep Staffers
      </h1>
      {% if rep %}
        <p class="text-muted mb-0">Staff members for {{ rep.name }}</p>
      {% else %}
        <p class="text-muted mb-0">All rep staffers in the system</p>
      {% endif %}
    </div>
  </div>

  <!-- Add Staffer Form -->
  <div class="card shadow-sm mb-4" style="border-left: 4px solid var(--royal-purple);">
    <div class="card-header" style="background: var(--pale-purple);">
      <h5 class="mb-0"><i class="bi bi-person-plus-fill"></i> Add New Staffer</h5>
    </div>
    <div class="card-body">
      <form method="post" action="{{ url_for('events.manage_staffers') }}">
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="username" class="form-label">Username <span class="text-danger">*</span></label>
            <input type="text" 
                   class="form-control" 
                   id="username" 
                   name="username" 
                   required 
                   minlength="3" 
                   maxlength="150"
                   pattern="[a-zA-Z0-9_]+"
                   placeholder="staffusername">
            <small class="text-muted">Letters, numbers, and underscores only</small>
          </div>
          <div class="col-md-6">
            <label for="password" class="form-label">Password <span class="text-danger">*</span></label>
            <input type="password" 
                   class="form-control" 
                   id="password" 
                   name="password" 
                   required 
                   minlength="10"
                   placeholder="Minimum 10 characters">
            <small class="text-muted">At least 10 characters</small>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label for="street_address" class="form-label">Street Address <span class="text-danger">*</span></label>
            <input type="text" 
                   class="form-control" 
                   id="street_address" 
                   name="street_address" 
                   required
                   maxlength="255"
                   placeholder="123 Main St">
          </div>
          <div class="col-md-6">
            <label for="city" class="form-label">City <span class="text-danger">*</span></label>
            <input type="text" 
                   class="form-control" 
                   id="city" 
                   name="city" 
                   required
                   maxlength="100"
                   placeholder="Jefferson City">
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label for="state" class="form-label">State <span class="text-danger">*</span></label>
            <input type="text" 
                   class="form-control" 
                   id="state" 
                   name="state" 
                   required
                   maxlength="2"
                   pattern="[A-Z]{2}"
                   placeholder="MO"
                   value="MO">
          </div>
          <div class="col-md-6">
            <label for="zipcode" class="form-label">ZIP Code <span class="text-danger">*</span></label>
            <input type="text" 
                   class="form-control" 
                   id="zipcode" 
                   name="zipcode" 
                   required
                   maxlength="10"
                   placeholder="65101">
          </div>
        </div>

        <button type="submit" class="btn" style="background: var(--royal-purple); color: white;">
          <i class="bi bi-person-plus-fill"></i> Add Staffer
        </button>
      </form>
    </div>
  </div>

  <!-- Staffers List -->
  {% if staffers %}
    <div class="card shadow-sm">
      <div class="card-header" style="background: var(--pale-purple);">
        <h5 class="mb-0"><i class="bi bi-people"></i> Current Staffers</h5>
      </div>
      <div class="list-group list-group-flush">
        {% for staffer in staffers %}
          <div class="list-group-item">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h6 class="mb-1" style="color: var(--deep-purple);">
                  <i class="bi bi-person-badge"></i> {{ staffer.username }}
                </h6>
                <small class="text-muted">
                  <i class="bi bi-geo-alt"></i> {{ staffer.city }}, {{ staffer.state }} {{ staffer.zipcode }}
                </small>
                {% if user.role == 'admin' and staffer.representative_id %}
                  <br><small class="text-muted">
                    <i class="bi bi-link"></i> Linked to Representative ID: {{ staffer.representative_id }}
                  </small>
                {% endif %}
              </div>
              <form method="post" 
                    action="{{ url_for('events.delete_staffer', staffer_id=staffer.id) }}"
                    style="display: inline;"
                    onsubmit="return confirm('Are you sure you want to delete this staffer?');">
                <button type="submit" class="btn btn-sm btn-outline-danger">
                  <i class="bi bi-trash"></i> Remove
                </button>
              </form>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  {% else %}
    <div class="alert" style="background: var(--pale-purple); border-left: 4px solid var(--royal-purple);">
      <i class="bi bi-info-circle-fill"></i> No staffers have been added yet.
    </div>
  {% endif %}

  <div class="mt-3">
    <a href="{{ url_for('events.manage_events') }}" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left"></i> Back to Events
    </a>
  </div>
{% endblock %}
