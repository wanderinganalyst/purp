{% extends 'base.html' %}

{% block title %}Shopping Cart - {{ event.title }} - Purp{% endblock %}

{% block content %}
  <div class="mb-4">
    <h1 class="h2 mb-1" style="color: var(--royal-purple);">
      <i class="bi bi-cart3"></i> Shopping Cart
    </h1>
    <p class="text-muted mb-0">{{ event.title }} - {{ event.event_date.strftime('%B %d, %Y') }}</p>
  </div>

  {% if cart_items %}
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <form method="post" action="{{ url_for('events.update_cart', event_id=event.id) }}">
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Price</th>
                  <th style="width: 150px;">Quantity</th>
                  <th>Subtotal</th>
                  <th style="width: 80px;"></th>
                </tr>
              </thead>
              <tbody>
                {% for cart_item in cart_items %}
                  <tr>
                    <td>
                      <strong>{{ cart_item.option.option_name }}</strong>
                      {% if cart_item.option.description %}
                        <br><small class="text-muted">{{ cart_item.option.description }}</small>
                      {% endif %}
                      <br><span class="badge bg-secondary">{{ cart_item.option.option_type }}</span>
                    </td>
                    <td>${{ "%.2f"|format(cart_item.option.price) }}</td>
                    <td>
                      <input type="number" 
                             class="form-control" 
                             name="quantity_{{ cart_item.item.id }}" 
                             value="{{ cart_item.item.quantity }}"
                             min="0"
                             max="50">
                    </td>
                    <td><strong>${{ "%.2f"|format(cart_item.subtotal) }}</strong></td>
                    <td>
                      <form method="post" 
                            action="{{ url_for('events.remove_from_cart', event_id=event.id, item_id=cart_item.item.id) }}"
                            style="display: inline;">
                        <button type="submit" class="btn btn-sm btn-outline-danger">
                          <i class="bi bi-trash"></i>
                        </button>
                      </form>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
              <tfoot>
                <tr>
                  <th colspan="3" class="text-end">Total:</th>
                  <th colspan="2">
                    <h4 class="mb-0" style="color: var(--royal-purple);">${{ "%.2f"|format(total) }}</h4>
                  </th>
                </tr>
              </tfoot>
            </table>
          </div>

          <div class="d-flex justify-content-between mt-3">
            <button type="submit" class="btn btn-outline-primary">
              <i class="bi bi-arrow-clockwise"></i> Update Cart
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Checkout Button -->
    <div class="card shadow-sm">
      <div class="card-body">
        <form method="post" action="{{ url_for('events.checkout_cart', event_id=event.id) }}">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h5 class="mb-1">Ready to complete your purchase?</h5>
              <p class="text-muted mb-0">Total: ${{ "%.2f"|format(total) }}</p>
            </div>
            <button type="submit" class="btn btn-success btn-lg">
              <i class="bi bi-cart-check-fill"></i> Checkout
            </button>
          </div>
        </form>
      </div>
    </div>
  {% else %}
    <div class="alert alert-info">
      <i class="bi bi-info-circle-fill"></i> 
      Your cart is empty. <a href="{{ url_for('events.view_event', event_id=event.id) }}">Browse event options</a> to add items.
    </div>
  {% endif %}

  <div class="mt-4">
    <a href="{{ url_for('events.view_event', event_id=event.id) }}" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left"></i> Back to Event
    </a>
  </div>
{% endblock %}
